<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculate SPANS Score for a Number of Normalization Methods — spans_procedure • pmartR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate SPANS Score for a Number of Normalization Methods — spans_procedure"><meta property="og:description" content="Ranks different combinations of subset and normalization methods based on
a score that captures how much bias a particular normalization procedure
introduces into the data. Higher score implies less bias."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmartR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Convenience_Functions.html">Convenience Functions</a>
    </li>
    <li>
      <a href="../articles/Data_Normalization.html">Data Normalization</a>
    </li>
    <li>
      <a href="../articles/Data_Object_Creation.html">Data Object Creation</a>
    </li>
    <li>
      <a href="../articles/Filter_Functionality.html">Filter Functions</a>
    </li>
    <li>
      <a href="../articles/Graphing_with_pmartR.html">Graphing with pmartR</a>
    </li>
    <li>
      <a href="../articles/RNAseq_Processing_Workflow.html">RNAseq Data Processing</a>
    </li>
    <li>
      <a href="../articles/Statistical_Analysis_with_pmartR.html">Statistical Analysis with the `pmartR` Package</a>
    </li>
    <li>
      <a href="../articles/Trelliscope_Vignette.html">Using Trelliscope Functions with pmartR</a>
    </li>
    <li>
      <a href="../articles/Typical_Processing_Workflow.html">Typical Processing Workflow</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/pmartR/pmartR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate SPANS Score for a Number of Normalization Methods</h1>
    <small class="dont-index">Source: <a href="https://github.com/pmartR/pmartR/blob/HEAD/R/spans.R" class="external-link"><code>R/spans.R</code></a></small>
    <div class="hidden name"><code>spans_procedure.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Ranks different combinations of subset and normalization methods based on
a score that captures how much bias a particular normalization procedure
introduces into the data. Higher score implies less bias.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spans_procedure</span><span class="op">(</span></span>
<span>  <span class="va">omicsData</span>,</span>
<span>  norm_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"mean"</span>, <span class="st">"zscore"</span>, <span class="st">"mad"</span><span class="op">)</span>,</span>
<span>  subset_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"los"</span>, <span class="st">"ppp"</span>, <span class="st">"rip"</span>, <span class="st">"ppp_rip"</span><span class="op">)</span>,</span>
<span>  params <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  group <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  sig_thresh <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  nonsig_thresh <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  min_nonsig <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  min_sig <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>omicsData</dt>
<dd><p>aobject of the class 'pepData' or 'proData' created by
<code><a href="as.pepData.html">as.pepData</a></code> or <code><a href="as.proData.html">as.proData</a></code> respectively. The data
must be log transformed (using edata_transform()) and have a grouping
structure, usually set by calling group_designation() on the object.</p></dd>


<dt>norm_fn</dt>
<dd><p>character vector indicating the normalization functions to
test. See details for the current offerings.</p></dd>


<dt>subset_fn</dt>
<dd><p>character vector indicating which subset functions to test.
See details for the current offerings.</p></dd>


<dt>params</dt>
<dd><p>list of additional arguments passed to the chosen subset
functions. See details for parameter specification and default values.</p></dd>


<dt>group</dt>
<dd><p>character specifying a column name in f_data that gives the
group assignment of the samples. Defaults to NULL, in which case the
grouping structure given in <code>attr(omicsData, 'group_DF')</code> is used.</p></dd>


<dt>n_iter</dt>
<dd><p>number of iterations used in calculating the background
distribution in step 0 of SPANS. Defaults to 1000.</p></dd>


<dt>sig_thresh</dt>
<dd><p>numeric value that specifies the maximum p-value for which
a biomolecule can be considered highly significant based on a
Kruskal-Wallis test. Defaults to 0.0001.</p></dd>


<dt>nonsig_thresh</dt>
<dd><p>numeric value that specifies the minimum p-value for
which a biomolecule can be considered non-significant based on a
Kruskal-Wallis test. Defaults to 0.5.</p></dd>


<dt>min_nonsig</dt>
<dd><p>integer value specifying the minimum number of
non-significant biomolecules identified in step 0 of SPANS in order to
proceed.  nonsig_thresh will be adjusted to the maximum value that gives
this many biomolecules.</p></dd>


<dt>min_sig</dt>
<dd><p>integer value specifying the minimum number of highly
significant biomolecules identified in step 0 of SPANS in order to proceed.
sig_thresh will be adjusted to the minimum value that gives this many
biomolecules.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments</p><table class="table table"><tr><td><code>location_thresh,
scale_thresh</code> The minimum p-value resulting from a Kruskal-Wallis test on
the location and scale parameters resulting from a normalization method in
order for that method to be considered a candidate for scoring.</td><td><code>verbose</code> Logical specifying whether to print the completion of SPANS
procedure steps to console. Defaults to TRUE.</td></tr></table></dd>


<dt>max_sig/max_nonsig</dt>
<dd><p>integer value specifying the maximum number of
highly significant/non-significant biomolecules identified in step 0 if
SPANS in order to proceed.  Excesses of highly significant/non-significant
biomolecules will be randomly sampled down to these values.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class 'SPANSRes', which is a dataframe containing
  columns for the subset method and normalization used, the parameters used
  in the subset method, and the corresponding SPANS score.  <br></p>



<p>The column 'mols_used_in_norm' contains the number of molecules that were
  selected by the subset method and subsequently used to determine the
  location/scale parameters for normalization.  The column 'passed selection'
  is <code>TRUE</code> if the subset+normalization procedure was selected for
  scoring.<br></p>



<p>The attribute 'method_selection_pvals' is a dataframe containing
  information on the p values used to determine if a method was selected for
  scoring (location_p_value, scale_p_value) as well as the probabilities
  (F_log_HSmPV, F_log_NSmPV) given by the empirical cdfs generated in the
  first step of SPANS.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Below are details for specifying function and parameter options.</p>
    </div>
    <div id="subset-functions">
    <h2>Subset Functions</h2>
    <p>Specifying a subset function indicates the subset
  of features (rows of <code>e_data</code>) that should be used for computing
  normalization factors. The following are valid options: "all", "los",
  "ppp", "rip", and "ppp_rip". <br></p><table class="table table"><tr><td></td><td>"all" is the subset
  that includes all features (i.e. no subsetting is done).</td></tr><tr><td></td><td>"los"
  identifies the subset of the features associated with the top <code>L</code>,
  where <code>L</code> is a proportion between 0 and 1, order statistics.
  Specifically, the features with the top <code>L</code> proportion of highest
  absolute abundance are retained for each sample, and the union of these
  features is taken as the subset identified (Wang et al., 2006).</td></tr><tr><td></td><td>"ppp" (orignally stands for percentage of peptides present) identifies the
  subset of features that are present/non-missing for a minimum
  <code>proportion</code> of samples (Karpievitch et al., 2009; Kultima et al.,
  2009).</td></tr><tr><td></td><td>"complete" subset of features that have no missing data
  across all samples.  Equivalent to "ppp" with proportion = 1.</td></tr><tr><td></td><td>"rip" identifies features with complete data that have a p-value greater
  than a defined threshold <code>alpha</code> (common values include 0.1 or 0.25)
  when subjected to a Kruskal-Wallis test based (non-parametric one-way
  ANOVA) on group membership (Webb-Robertson et al., 2011).</td></tr><tr><td></td><td>"ppp_rip" is equivalent to "rip" however rather than requiring features
  with complete data, features with at least a <code>proportion</code> of
  non-missing values are subject to the Kruskal-Wallis test.</td></tr></table></div>
    <div id="normalization-functions">
    <h2>Normalization Functions</h2>
    <p>Specifying a normalization function
  indicates how normalization scale and location parameters should be
  calculated. The following are valid options: "median", "mean", "zscore",
  and "mad". Parameters for median centering are calculated if "median" is
  specified. The location estimates are the sample-wise medians of the subset
  data. There are no scale estimates for median centering. Parameters for
  mean centering are calculated if "mean" is specified. The location
  estimates are the sample-wise means of the subset data. There are no scale
  estimates for median centering. Parameters for z-score transformation are
  calculated if "zscore" is specified. The location estimates are the subset
  means for each sample. The scale estimates are the subset standard
  deviations for each sample. Parameters for median absolute deviation (MAD)
  transformation are calculated if "mad" is specified.</p>
    </div>
    <div id="specifying-subset-parameters-using-the-params-argument">
    <h2>Specifying Subset Parameters Using the <code>params</code> argument</h2>
    

<p>Parameters for the chosen subset function should be specified in a list.
  The list elements should have names corresponding to the subset function
  inputs and contain a <em>list</em> of numeric values.  The elements of
  ppp_rip will be length 2 numeric vectors, corresponding to the parameters
  for ppp and rip. See examples.</p>
<p>The following subset functions have parameters that can be specified:</p><table class="table table"><tr><td>los</td><td>list of values between 0 and 1 indicating the top
  proportion of order statistics. Defaults to list(0.05,0.1,0.2,0.3) if
  unspecified.</td></tr><tr><td></td><td></td></tr><tr><td>ppp</td><td>list of values between 0 and 1
  specifying the proportion of samples that must have non-missing values for
  a feature to be retained. Defaults to list(0.1,0.25,0.50,0.75) if
  unspecified.</td></tr><tr><td></td><td></td></tr><tr><td>rip</td><td>list of values between 0 and 1
  specifying the p-value threshold for determining rank invariance. Defaults
  to list(0.1,0.15,0.2,0.25) if unspecified.</td></tr><tr><td></td><td></td></tr><tr><td>ppp_rip</td><td>list
  of length 2 numeric vectors corresponding to the RIP and PPP parameters
  above. Defaults list(c(0.1,0.1), c(0.25, 0.15), c(0.5, 0.2), c(0.75,0.25))
  if unspecified.</td></tr></table></div>
    <div id="references">
    <h2>References</h2>
    <p>Webb-Robertson BJ, Matzke MM, Jacobs JM, Pounds JG, Waters KM. A
  statistical selection strategy for normalization procedures in LC-MS
  proteomics experiments through dataset-dependent ranking of normalization
  scaling factors. Proteomics. 2011;11(24):4736-41.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Daniel Claborne</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pmartR/pmartRdata" class="external-link">pmartRdata</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="edata_transform.html">edata_transform</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, data_scale <span class="op">=</span> <span class="st">"log2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pep_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="group_designation.html">group_designation</a></span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, main_effects <span class="op">=</span> <span class="st">"Phenotype"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## default parameters</span></span></span>
<span class="r-in"><span><span class="va">spans_res</span> <span class="op">&lt;-</span> <span class="fu">spans_procedure</span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## specify only certain subset and normalization functions</span></span></span>
<span class="r-in"><span><span class="va">spans_res</span> <span class="op">&lt;-</span> <span class="fu">spans_procedure</span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, norm_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"zscore"</span><span class="op">)</span>, subset_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"los"</span>, <span class="st">"ppp"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## specify parameters for supplied subset functions, notice ppp_rip takes a vector of two numeric arguments.</span></span></span>
<span class="r-in"><span><span class="va">spans_res</span> <span class="op">&lt;-</span> <span class="fu">spans_procedure</span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, subset_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"los"</span>, <span class="st">"ppp"</span><span class="op">)</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>los <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span>, ppp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">spans_res</span> <span class="op">&lt;-</span> <span class="fu">spans_procedure</span><span class="op">(</span>omicsData <span class="op">=</span> <span class="va">pep_object</span>, subset_fn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"rip"</span>, <span class="st">"ppp_rip"</span><span class="op">)</span>, params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.4</span><span class="op">)</span>, ppp_rip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Lisa Bramer, Kelly Stratton.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

